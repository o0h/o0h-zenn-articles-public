---
title: "├ W-①: STEP-1 パッケージ定義ファイルの読み込み"
---

# STEP-1: `composer.lock`ファイルの読み込み

## A. 課題について

### 背景

まずは最初に、プロジェクトの定義ファイルを読み込む必要があります。

ちなみに、実際のComposerでは `.lock`ファイル単独では処理できません。Tinyposerでは、実装の簡略化のために`.lock`だけで動かしてしまいます。

![](/images/2_work1_2_step1_a/2/json-file-required.png)
_composer.jsonがなくてエラーになっている様子_

閑話休題。では、`.lock`ファイルはどのように読み込めばいいでしょうか？

実は、全く難しいことはありません！拡張子こそちがえど、その内実はJSONファイルです。テキストファイルとして読み込んだうえで、JSONとしてデコードしてあげれば全て完了です！

### 課題

このハンズオンは、ステップごとに用意された「作業用ファイル」を編集しながら進めていきます。
各ステップで与えられた課題をクリアするように、コードを書いていきましょう。

|                | コンテナ内のパス                   |
| -------------- | ---------------------------------- |
| 作業用ファイル | `/opt/work/1_install/step1.php`    |
| 実装サンプル   | `/opt/example/1_install/step1.php` |

1. `/opt/work/composer.lock`にある`.lock`ファイルを読み込んでください。
2. 読み込んだファイルの内容を連想配列にして、変数 `$lockData `に代入してください。

## 参考: このステップの実装で役に立ちそうな関数etc

- https://php.net/file_get_contents
- https://php.net/fread
- https://php.net/json_decode

## B. 実装例とコードの解説

作業前のファイルの全景

```php
<?php

/* === STEP-1 ココから === */
// $lockData = ・・・

/* === STEP-1 ココまで === */
```

### 1. `/opt/work/composer.lock`にある`.lock`ファイルを読み込んでください。

内容が安全であることが担保できていて、ローカルにあるファイルを読み込むには `file_get_contents()`関数で充分でしょう。

その際、正常に読み込めたかの判定とエラーハンドリングも必要になります。今回は簡易実装を行うハンズオンなので、端折ります。

```php
/* === STEP-1 ココから === */
$json = file_get_contents('/opt/work/composer.lock');
/* === STEP-1 ココまで === */
```

### 2. 読み込んだファイルの内容を連想配列にして、変数 `$lockData `に代入してください。

これも前項と同様に、「かなり安全だと信じ込んでの実装」ということで簡易的に済ませます。 `json_decode()`で充分でしょう。要件として「連想配列で」と指定されているので、第二引数に`true`指定が必要です

```php
/* === STEP-1 ココから === */
$json = file_get_contents('/opt/work/composer.lock');
$lockData = json_decode($json, true);
/* === STEP-1 ココまで === */
```

:::message
是非、`comopser.lock`はどんな情報を保持しているのか？を知るために、`var_dump()`を掛けて覗いてみてください。
:::

---

STEP-1はコレで完了です。

終わったら、課題の内容をクリアする実装ができているかを確認しましょう。
用意されている`make` コマンドで検査できます。コンテナ内ではなく、コンテナの外側（ホストマシン）で実行することに注意してください。

**ホストから**

```
make work1
```

もし`make`が使えないなど、コンテナ内で行う場合には下記のコマンドを利用してください。

**コンテナ内で**

```sh
php /opt/work/1_install/main.php
```

『✅ Step1が完了しました！』と出力されていれば、成功です。自信を持って、次のステップに進みましょう！
(STEP-1が無事に終わると同時に、「STEP-2が失敗する」状態になります。少し後味が悪いかも知れませんが、しっかり前進しているので気にしなくて大丈夫です！)

![](/images/2_work1_2/1/step1-finish.gif)
