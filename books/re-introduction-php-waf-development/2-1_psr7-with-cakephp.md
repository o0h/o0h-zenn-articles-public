---
title: "5章 PSR-7: HTTP messageとCakePHPのリクエスト、レスポンス"
free: true
---

「PSR-7: HTTP message」は、HTTPリクエストを受信・送信する際の内容について、ライブラリやフレームワークといったプロジェクトをまたいで共通認識を持てるように、その構造と取り扱い方を定めたものです。

プレーンなPHPにおいては、クライアントからアプリケーションへリクエストされた内容については `$_REQUEST` `$_POST`といったスーパーグローバル変数によって、取得や操作が可能です。また、レスポンスの方法に目を向けると、最終的には `header()` 関数や`echo` によって出力されることになります。

こうしたプリミティブな操作はいくつかの問題を抱えていました。

* スーパーグローバル変数は、システムとの結合が激しかったり、テストを行いにくい
* それらの変数はミュータブルとなっており、内容の変更を追いにくい(ライフサイクルが不定かになる)
* 「誰がコンテンツを出力するか」の責務を明確にしておかないと、(`header()`による出力が)適切に動作しない可能性が生じ、実装者にとってアプリケーションが不安定なものになる

これらの問題に対して取られた対策は、「スーパーグローバル変数の入出力や、レスポンスとしての出力を直接的に扱う仕事は、フレームワークの中に隠蔽しよう」というものでした。これによって、アプリケーション開発者は、スーパーグローバル変数や出力処理について意識する必要から開放されます。
そのために、各フレームワークやライブラリは独自に「Request」「Response」というオブジェクトを持つことになります。

例えば、以前のCakePHPの例についてはこちらで見ることが出来ます。

* CakePHP2: https://book.cakephp.org/2/ja/controllers/request-response.html#cakeresponse
* CakePHP3.2: https://github.com/cakephp/cakephp/blob/3.2.14/src/Network/Request.php
  * 3.3にて、PSR-7の実装が導入されています([issue](https://github.com/cakephp/cakephp/issues/6960) / [roadmap](https://github.com/cakephp/cakephp/wiki/3.3-Roadmap))

* フレームワークから最終的に返答するレスポンスについては、フレームワークの作法に則って独自の型で取り回し、
