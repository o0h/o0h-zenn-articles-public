---
title: "3章: ステップ実行の基礎"
free: true
---

以後のチュートリアル本編においての用語の統一もかねて、ステップ実行を行う上での「まずこれだけは抑えておきたい」という基礎的な概念や用語を整理していきます。

- ブレイクポイント(breakpoint))
- フレーム(frame)
- ステップの操作
  - Step Over
  - Step Into
  - Step Out

## ブレイクポイント

ブレイクポイントとは、「処理を止めたい場所」です。

例えば、「プログラムを実行して、 `AppleController.php` ファイルの、29行目付近の状態を調べたい」となったら、`AppleController.php` の29行目にブレイクポイントを仕掛けることになります。
PhpStormで言うと、「行番号の上に赤丸を打つ」のが最も基本的な設定の仕方です。

![](/images/1-3_step-basic/2024-05-10-03-08-36.png)

これは「行」に対してブレイクポイントを設定している例ですが、他にもいくつかの種類があります。  
 別のブレイクポイントについては、適宜チュートリアル内で紹介していきます。

## フレーム

PHPのプログラムは、関数やメソッドを呼び出し合うことで「層」を形成します。  
 これら1つ1つの「層」のことを、「フレーム」と呼ぶと理解してください。  
 フレームには、「呼び出しに際して受け取った値(引数)」と「処理終了時に戻る先」といった情報が保持される・・のですが、本チュートリアルでは意識しなくても問題なく進めるはずなので、気になる方は調べてみてください。

よく見かけるであろう、身近な例を上げると「スタックトレースの1行ずつ」がフレームに該当します。

例えば、次のようなコードが合ったとします。

```php
<?php

function hoge() { fuga(); }
function fuga() { piyo(); }
function piyo() { throw new \LogicException(); }

try {
   hoge();
} catch (\Exception $e) {
   foreach ($e->getTrace() as $frame) {
       echo 'line: ' . $frame['line'] . ', function: ' . $frame['function'] . PHP_EOL;
   }
}
```

実行すると、次の出力結果が得られます。

```
line: 4, function: piyo
line: 3, function: fuga
line: 8, function: hoge
```

これは、「例外が発生するまでにどんな層を通ってきたか」という経路の記録であり、現れている1行ごとがフレームと呼ばれる概念に相当します。

## ステップの操作

ブレイクポイントを使って任意の場所で止めることが出来た！！となれば、次に必要なのは、調べたいところまで処理を進めることです。  
そのため、ステップの操作も抑えておきましょう。  
ここでは、最も基本的な3つの名前だけ紹介します。

具体例を交えて説明を進めたいので、また(変な)コードを題材として紹介します。

```php
<?php

function deepHoge()
{
    echo 'deep, and..' . PHP_EOL;
    echo 'deepHoge' . PHP_EOL;
}
function fuga()
{
    echo 'fuga' . PHP_EOL;;
}
function hogeFuga()
{
    deepHoge();
    fuga();
}
function main()
{
    echo 'hoge' . PHP_EOL;
    fuga();
    hogeFuga();
}

main();
```

念の為、実行すると得られる出力結果は次のとおりになります。

```
hoge
fuga
deep, and..
deepHoge
fuga
```

さて！  
これを、フレームの概念を重視して呼び出し先の関係にまとめたものが、次の図です。

![](/images/1-3_step-basic/2024-05-10-03-28-55.png)

### Step Over

「同じフレームの中で次に進める」というものです。

実践の緑の丸が付いているポイントから、Step Overをすると、破線の緑の丸がついているポイントへと進みます。
![](/images/1-3_step-basic/2024-05-10-03-30-29.png)

この時、フレームは同一のまま、現在位置の「行番号」が変化していることに注目してください(24 -> 25へ)

### Step Into

「中へ」という単語が示す通り、1つ深いフレームへと進みます。

![](/images/1-3_step-basic/2024-05-10-03-33-19.png)

Step Overとは打って変わって、フレームが1弾積み重なりました。

### Step Out

「外へ抜け出す」ように進みます。つまり、1つ前のフレームへ回帰します。
前のフレームへ、といっても決して処理が巻き戻るわけではありません。現在のフレームにおける処理を最後まで完遂して、`return` していくのがStep Outの操作です。

![](/images/1-3_step-basic/2024-05-10-03-37-38.png)
今度は、右から左に処理が移っています
フレームが1段浅くなりましたね。

## 基本中の基本は、ひとまずここまで！
これらの概念を、PhpStormを利用したXdebugステップ実行を行った際の機能配置・表示は次のようになります。
![](/./images/1-3_step-basic/1-3_step-basic_2024-05-11-03-25-07.png)

もちろん、まだまだ機能はたくさんあります。が・・・見ているだけではツマラナイですよね！  
座学はここまでにして、次からは「目的を持ってコードを読み解き、理解していく」実践形式でのチュートリアルとなります。
